<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABIDINAI ALRM CERDAS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Styling untuk Tema Jarvis/Futuristik */
        :root {
            --bg-dark: #000a12;
            --accent-color: #00bcd4;
            --text-light: #e0f7fa;
            --glow-shadow: 0 0 10px var(--accent-color), 0 0 20px var(--accent-color);
            --border-color: rgba(0, 188, 212, 0.5);
            --button-bg: rgba(0, 188, 212, 0.2);
        }

        body {
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: var(--bg-dark);
            color: var(--text-light);
            transition: background-color 0.3s ease;
        }

        .container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
            width: 100%;
        }

        .header {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 30px;
            color: var(--accent-color);
            text-shadow: var(--glow-shadow);
        }

        .jarvis-box {
            background-color: rgba(0, 10, 18, 0.7);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 25px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 0 15px rgba(0, 188, 212, 0.3);
        }

        .tab-content {
            display: none;
            width: 100%;
            max-width: 450px;
        }
        .tab-content.active {
            display: block;
        }

        /* Input dan Select */
        select, input[type="time"], input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background-color: rgba(0, 188, 212, 0.1);
            border: 1px solid var(--accent-color);
            border-radius: 5px;
            color: var(--text-light);
            font-size: 16px;
            box-sizing: border-box;
            transition: all 0.3s;
        }
        select:focus, input:focus {
            box-shadow: var(--glow-shadow);
            outline: none;
            border-color: var(--accent-color);
        }
        
        ::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Tombol */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px 25px;
            border: 2px solid var(--accent-color);
            border-radius: 5px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 700;
            color: var(--accent-color);
            background-color: var(--button-bg);
            transition: all 0.3s;
            text-transform: uppercase;
        }

        button:hover {
            box-shadow: var(--glow-shadow);
            background-color: rgba(0, 188, 212, 0.3);
        }
        
        #setAlarm, #startStopwatch, #startTimer {
            border-color: #4CAF50;
            color: #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        #setAlarm:hover, #startStopwatch:hover, #startTimer:hover {
            box-shadow: 0 0 10px #4CAF50, 0 0 20px #4CAF50;
        }

        #stopAlarm, #resetStopwatch {
            border-color: #f44336;
            color: #f44336;
            background-color: rgba(244, 67, 54, 0.1);
        }
        #stopAlarm:hover, #resetStopwatch:hover {
            box-shadow: 0 0 10px #f44336, 0 0 20px #f44336;
        }
        
        #pauseStopwatch {
            border-color: #ffc107;
            color: #ffc107;
            background-color: rgba(255, 193, 7, 0.1);
        }
        #pauseStopwatch:hover {
             box-shadow: 0 0 10px #ffc107, 0 0 20px #ffc107;
        }


        #stopwatchDisplay {
            font-size: 3em;
            margin: 20px 0;
            color: var(--accent-color);
            text-shadow: var(--glow-shadow);
            letter-spacing: 2px;
            background-color: rgba(0, 10, 18, 0.5);
            padding: 10px 20px;
            border-radius: 5px;
        }
        
        @media (max-width: 400px) {
            #stopwatchDisplay {
                font-size: 2.5em; 
            }
        }


        #alarmStatus, #timerStatus {
            font-size: 1.2em;
            font-weight: 400;
            color: var(--text-light);
            margin-top: 15px;
            padding: 10px;
            border-top: 1px dashed var(--border-color);
        }

        /* Navigasi Tab (di bawah) */
        .tab-nav {
            display: flex;
            width: 100%;
            justify-content: space-around;
            background-color: var(--bg-dark);
            padding: 10px 0;
            box-shadow: 0 0 15px rgba(0, 188, 212, 0.5);
            position: sticky;
            bottom: 0;
            z-index: 10;
        }

        .tab-nav button {
            flex-grow: 1;
            background: none;
            border: none;
            padding: 15px 10px;
            font-size: 16px;
            opacity: 0.6;
            color: var(--text-light);
            transition: all 0.3s;
        }

        .tab-nav button.active {
            font-weight: 700;
            color: var(--accent-color);
            opacity: 1;
            border-bottom: 3px solid var(--accent-color);
            text-shadow: var(--glow-shadow);
        }

        .footer-info {
            font-size: 0.7em;
            color: rgba(255, 255, 255, 0.4);
            padding: 10px;
            background: var(--bg-dark);
            width: 100%;
            box-sizing: border-box;
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="container" id="main-container">

        <h1 class="header">A B I D I N A I <br> Time Protocol</h1>

        <div id="alarm-tab" class="tab-content active jarvis-box">
            <h2>Alarm System</h2>
            
            <input type="time" id="alarmTime" value="07:00">
            <input type="text" id="alarmMessage" placeholder="Pesan Peringatan (akan diucapkan)">
            
            <div class="button-group">
                <button id="setAlarm">Set Alarm</button>
                <button id="stopAlarm">Hentikan Suara</button>
            </div>
            
            <p id="alarmStatus">Status: Siaga</p>
        </div>

        <div id="stopwatch-tab" class="tab-content jarvis-box">
            <h2>Stopwatch Counter</h2>

            <div id="stopwatchDisplay">00:00:00.00</div>
            
            <div class="button-group">
                <button id="startStopwatch">Mulai</button>
                <button id="pauseStopwatch" style="display:none;">Jeda</button>
                <button id="resetStopwatch">Reset</button>
            </div>
            
            <p id="stopwatchStatus"></p>
        </div>

        <div id="timer-tab" class="tab-content jarvis-box">
            <h2>Countdown Timer</h2>
            
            <input type="number" id="timerInputMinutes" placeholder="Menit" value="5" min="1">
            
            <div class="button-group">
                <button id="startTimer">Mulai</button>
            </div>

            <p id="timerStatus">Status: Siaga</p>
        </div>

    </div>

    <div class="tab-nav">
        <button id="nav-alarm" class="active" onclick="showTab('alarm')">Alarm</button>
        <button id="nav-stopwatch" onclick="showTab('stopwatch')">Stopwatch</button>
        <button id="nav-timer" onclick="showTab('timer')">Timer</button>
    </div>

    <div class="footer-info">
         ABIDINAI ALARAM CERDAS
    </div>


    <script>
        // --- JAVASCRIPT LOGIC ---
        const synth = window.speechSynthesis;
        let alarmTimeout;
        const alarmStatus = document.getElementById('alarmStatus');
        
        let indonesianVoice = null;

        function populateVoices() {
            const voices = synth.getVoices();
            indonesianVoice = voices.find(voice => 
                voice.lang.startsWith('id') || 
                voice.name.includes('Google') ||
                voice.name.includes('ID')
            );
        }

        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = populateVoices;
        }
        populateVoices(); 
        
        let speakingQueue = [];
        let isSpeaking = false;

        // Fungsi untuk memproses antrian ucapan (mengucapkan satu per satu)
        function processSpeakingQueue() {
            if (speakingQueue.length > 0 && !isSpeaking) {
                isSpeaking = true;
                const text = speakingQueue.shift();
                const utterThis = new SpeechSynthesisUtterance(text);
                
                if (indonesianVoice) {
                    utterThis.voice = indonesianVoice;
                } else {
                    utterThis.lang = 'id-ID'; 
                }

                utterThis.pitch = 1.0; 
                utterThis.rate = 1.0; 
                
                utterThis.onend = () => {
                    isSpeaking = false;
                    processSpeakingQueue(); // Panggil chunk berikutnya
                };
                utterThis.onerror = (e) => {
                    console.error('Speech synthesis error:', e);
                    isSpeaking = false;
                    processSpeakingQueue(); 
                };

                synth.speak(utterThis);
            }
        }

        // FUNGSI INTI: MEMECAH TEKS SECARA AGRESIF BERDASARKAN JUMLAH KARAKTER
        function speak(text) {
            stopSpeaking(); 
            speakingQueue = [];
            
            if (typeof text !== 'string' || text.trim() === '') {
                return;
            }
            
            const maxChunkLength = 180; // Ukuran chunk yang lebih aman
            let remainingText = text.trim();

            while (remainingText.length > 0) {
                let chunk;
                if (remainingText.length <= maxChunkLength) {
                    chunk = remainingText;
                    remainingText = '';
                } else {
                    // Coba cari spasi (pemisah kata) di sekitar batas chunk
                    let safeEnd = remainingText.lastIndexOf(' ', maxChunkLength);
                    
                    if (safeEnd > maxChunkLength - 50 && safeEnd !== -1) {
                        // Jika ditemukan spasi yang aman, potong di sana
                        chunk = remainingText.substring(0, safeEnd);
                        remainingText = remainingText.substring(safeEnd).trim();
                    } else {
                        // Jika tidak ada spasi yang baik (misalnya teks tanpa spasi), potong paksa
                        chunk = remainingText.substring(0, maxChunkLength);
                        remainingText = remainingText.substring(maxChunkLength).trim();
                    }
                }

                if (chunk.length > 0) {
                    speakingQueue.push(chunk);
                }
            }
            
            processSpeakingQueue();
        }

        // Fungsi untuk menghentikan ucapan (juga membersihkan antrian)
        function stopSpeaking() {
            if (synth.speaking) {
                synth.cancel();
            }
            isSpeaking = false;
            speakingQueue = [];
        }


        // 1. Logika Navigasi (Tab)
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-nav button').forEach(navBtn => {
                navBtn.classList.remove('active');
            });

            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.getElementById(`nav-${tabName}`).classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            showTab('alarm');
        });


        // 2. Logika ALARM 
        document.getElementById('setAlarm').addEventListener('click', () => {
            stopSpeaking(); 

            if (alarmTimeout) {
                clearTimeout(alarmTimeout);
            }

            const alarmTimeInput = document.getElementById('alarmTime').value;
            const customMessage = document.getElementById('alarmMessage').value || "Waktu telah tiba, segera bangun.";

            if (!alarmTimeInput) {
                alert("ERROR: Mohon atur waktu alarm.");
                return;
            }

            const [hours, minutes] = alarmTimeInput.split(':').map(Number);
            
            const now = new Date();
            let alarmDate = new Date();
            alarmDate.setHours(hours, minutes, 0, 0);

            if (alarmDate <= now) {
                alarmDate.setDate(alarmDate.getDate() + 1);
            }

            const timeToAlarm = alarmDate.getTime() - now.getTime();
            const formattedTime = alarmTimeInput;
            const nextDayText = (alarmDate.getDate() !== now.getDate()) ? " (Besok)" : "";
            
            const spokenMessage = `Alarm Aktif! Ini adalah pukul ${formattedTime}. ${customMessage}`;

            if (timeToAlarm > 0) {
                alarmStatus.innerHTML = `Alarm diaktifkan: ${formattedTime}${nextDayText}<br>Pesan: ${customMessage}`;
                speak("Alarm diatur. Selamat bertugas.");
                
                alarmTimeout = setTimeout(() => {
                    alarmStatus.innerHTML = "Status: Suara Alarm Berbunyi!";
                    
                    const loopSpeak = () => {
                        speak(spokenMessage);
                        setTimeout(() => {
                            // Cek apakah suara sudah selesai diucapkan sebelum mengulang
                            if (alarmTimeout && speakingQueue.length === 0 && !isSpeaking) {
                                loopSpeak();
                            } else if (alarmTimeout) {
                                // Jika masih ada antrian yang diucapkan, tunggu sebentar
                                setTimeout(loopSpeak, 1000); 
                            }
                        }, 5000); 
                    };
                    
                    loopSpeak();
                    
                }, timeToAlarm);
            }
        });

        document.getElementById('stopAlarm').addEventListener('click', () => {
            if (alarmTimeout) {
                clearTimeout(alarmTimeout);
                alarmTimeout = null;
            }
            stopSpeaking(); 
            alarmStatus.textContent = "Status: Siaga";
            speak("Alarm dihentikan. Siaga.");
        });


        // 3. Logika STOPWATCH 
        let stopwatchInterval;
        let startTime = 0;
        let elapsedTime = 0;
        let isRunning = false;
        const stopwatchDisplay = document.getElementById('stopwatchDisplay');
        const startStopwatchBtn = document.getElementById('startStopwatch');
        const pauseStopwatchBtn = document.getElementById('pauseStopwatch');
        const resetStopwatchBtn = document.getElementById('resetStopwatch');

        function formatTime(ms) {
            const centiseconds = Math.floor((ms % 1000) / 10);
            const seconds = Math.floor((ms / 1000) % 60);
            const minutes = Math.floor((ms / (1000 * 60)) % 60);
            const hours = Math.floor(ms / (1000 * 60 * 60));

            return [
                hours.toString().padStart(2, '0'),
                minutes.toString().padStart(2, '0'),
                seconds.toString().padStart(2, '0')
            ].join(':') + '.' + centiseconds.toString().padStart(2, '0');
        }

        function updateStopwatch() {
            elapsedTime = Date.now() - startTime;
            stopwatchDisplay.textContent = formatTime(elapsedTime);
        }

        startStopwatchBtn.addEventListener('click', () => {
            if (!isRunning) {
                isRunning = true;
                startTime = Date.now() - elapsedTime;
                stopwatchInterval = setInterval(updateStopwatch, 10);
                startStopwatchBtn.style.display = 'none';
                pauseStopwatchBtn.style.display = 'inline-block';
                
                speak(elapsedTime > 0 ? "Stopwatch dilanjutkan." : "Stopwatch dimulai.");
            }
        });

        pauseStopwatchBtn.addEventListener('click', () => {
            if (isRunning) {
                isRunning = false;
                clearInterval(stopwatchInterval);
                startStopwatchBtn.textContent = 'Lanjut';
                startStopwatchBtn.style.display = 'inline-block';
                pauseStopwatchBtn.style.display = 'none';
                
                speak("Stopwatch dijeda. Waktu saat ini: " + stopwatchDisplay.textContent.replace(/\./g, " koma ").replace(/:/g, " jam "));
            }
        });

        resetStopwatchBtn.addEventListener('click', () => {
            isRunning = false;
            clearInterval(stopwatchInterval);
            elapsedTime = 0;
            stopwatchDisplay.textContent = "00:00:00.00";
            startStopwatchBtn.textContent = 'Mulai';
            startStopwatchBtn.style.display = 'inline-block';
            pauseStopwatchBtn.style.display = 'none';
            
            speak("Stopwatch direset. Siaga.");
        });


        // 4. Logika HITUNG MUNDUR (Timer)
        let timerInterval;
        let timeRemaining = 0;
        let isTimerRunning = false;
        const timerInput = document.getElementById('timerInputMinutes');
        const timerStatus = document.getElementById('timerStatus');
        const startTimerBtn = document.getElementById('startTimer');

        function formatTimer(totalSeconds) {
            const seconds = totalSeconds % 60;
            const minutes = Math.floor(totalSeconds / 60);

            return [
                minutes.toString().padStart(2, '0'),
                seconds.toString().padStart(2, '0')
            ].join(':');
        }

        function updateTimer() {
            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                isTimerRunning = false;
                timerStatus.textContent = "Status: Time Out! Mission Complete.";
                startTimerBtn.textContent = "Mulai";
                timerInput.disabled = false;
                
                const timerMessage = "Hitung mundur selesai! Perintah sudah dieksekusi.";
                speak(timerMessage);
                
                alert("COUNTDOWN COMPLETE!");
                return;
            }

            timerStatus.textContent = `Waktu Tersisa: ${formatTimer(timeRemaining)}`;
            timeRemaining--;
        }

        startTimerBtn.addEventListener('click', () => {
            if (isTimerRunning) {
                isTimerRunning = false;
                clearInterval(timerInterval);
                startTimerBtn.textContent = "Lanjut";
                timerInput.disabled = false;
                timerStatus.textContent = `Status: Dijeda. ${formatTimer(timeRemaining)} tersisa.`;
                speak("Timer dijeda.");

            } else {
                const minutes = parseInt(timerInput.value);
                
                if (startTimerBtn.textContent === "Mulai") {
                    if (isNaN(minutes) || minutes <= 0) {
                        alert("ERROR: Masukkan durasi yang valid.");
                        return;
                    }
                    timeRemaining = minutes * 60;
                    speak(`Timer dimulai untuk ${minutes} menit.`);
                } else {
                    speak("Timer dilanjutkan.");
                }
                
                isTimerRunning = true;
                timerInput.disabled = true;
                timerInterval = setInterval(updateTimer, 1000);
                startTimerBtn.textContent = "Jeda";
            }
        });

        timerInput.addEventListener('input', () => {
            if (!isTimerRunning && startTimerBtn.textContent !== "Mulai") {
                startTimerBtn.textContent = "Mulai";
                timerStatus.textContent = "Status: Siaga";
                stopSpeaking(); 
                speak("Timer direset karena perubahan input.");
            }
        });
    </script>

</body>
</html>
