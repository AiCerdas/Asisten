<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ABIDINAI Kreator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Gaya Dasar dari AbidinAI */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); /* Latar Belakang Gelap Khas Kreator */
      color: white;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }
    
    .container {
      width: 100%;
      max-width: 500px;
      background: rgba(10, 15, 35, 0.8);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 255, 255, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0,255,255,0.1) 0%, rgba(0,0,0,0) 70%);
      z-index: -1;
    }
    
    .header {
      margin-bottom: 20px;
      position: relative;
      padding-bottom: 15px;
    }
    
    .header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 25%;
      width: 50%;
      height: 2px;
      background: linear-gradient(to right, transparent, cyan, transparent);
    }
    
    .title {
      font-size: 28px;
      margin-bottom: 10px;
      background: linear-gradient(90deg, cyan, #00ffaa);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    
    .developer {
      font-size: 16px;
      color: #ccc;
      margin-bottom: 15px;
    }
    
    .developer b {
      color: cyan;
    }
    
    .chat-container {
      background: rgba(0, 10, 20, 0.7);
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid rgba(0, 255, 255, 0.3);
      box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.2);
    }
    
    #chatbox {
      width: 100%;
      height: 300px;
      padding: 15px;
      overflow-y: auto;
      text-align: left;
      background: rgba(0, 5, 15, 0.8);
      border-radius: 10px;
      white-space: pre-line;
      border: 1px solid rgba(0, 255, 255, 0.2);
    }
    
    #chatbox::-webkit-scrollbar {
      width: 8px;
    }
    
    #chatbox::-webkit-scrollbar-track {
      background: rgba(0, 20, 40, 0.5);
    }
    
    #chatbox::-webkit-scrollbar-thumb {
      background: cyan;
      border-radius: 4px;
    }
    
    .message {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 10px;
      animation: fadeIn 0.3s ease;
      font-size: 14px;
    }
    
    .user-message {
      background: rgba(0, 50, 100, 0.3);
      border-left: 3px solid #00aaff;
    }
    
    .ai-message {
      background: rgba(0, 80, 60, 0.3);
      border-left: 3px solid #00ffaa;
    }
    
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    #messageInput {
      flex: 1;
      padding: 12px 15px;
      border-radius: 30px;
      border: none;
      background: rgba(0, 20, 40, 0.7);
      color: white;
      font-size: 16px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }
    
    #messageInput:focus {
      outline: none;
      border-color: cyan;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }
    
    #sendButton {
      padding: 12px 25px;
      border-radius: 30px;
      border: none;
      background: linear-gradient(45deg, #00ccff, #00ffcc);
      color: black;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    #sendButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
    }
    
    #sendButton:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(0, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: cyan;
      animation: spin 1s ease-in-out infinite;
      vertical-align: middle;
      margin-left: 10px;
    }
    
    .typing-indicator {
      color: #aaa;
      font-style: italic;
      padding: 10px;
    }
    
    .code-container {
      position: relative;
      margin: 15px 0;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 200, 255, 0.9);
      color: black;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      cursor: pointer;
      z-index: 10;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .copy-btn:hover {
      background: cyan;
      box-shadow: 0 0 10px cyan;
    }
    
    pre {
      background: rgba(0, 17, 34, 0.8);
      color: #0ff;
      padding: 20px 15px 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Fira Code', 'Courier New', monospace;
      font-size: 14px;
      white-space: pre-wrap;
      border: 1px solid rgba(0, 255, 255, 0.2);
      text-align: left;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @media (max-width: 600px) {
      .container {
        padding: 15px;
        border-radius: 15px;
      }
      
      .title {
        font-size: 24px;
      }
      
      #chatbox {
        height: 250px;
      }
      
      .input-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title"><i class="fas fa-video"></i> ABIDINAI Kreator</h1>
      <p class="developer"><b>Spesialis:</b> Konten Kreator & Viralitas</p>
    </div>
    
    <div class="chat-container">
      <div id="chatbox"></div>
    </div>
    
    <div class="input-group">
      <input type="text" id="messageInput" placeholder="Tanya tentang konten, viral, atau medsos..." onkeypress="handleKeyPress(event)">
      <button onclick="sendMessage()" id="sendButton">
        <i class="fas fa-paper-plane"></i> Kirim
      </button>
    </div>
    
    <div style="margin-top: 15px; font-size: 14px; color: #00ffaa;">
      <i class="fas fa-plug"></i>
      <span>Terhubung ke Server ABIDINAI</span>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const chatbox = document.getElementById("chatbox");
      const welcomeMsg = document.createElement("div");
      welcomeMsg.className = "message ai-message";
      welcomeMsg.innerHTML = `
        <strong>ABIDINAI Kreator:</strong>  Hai gaes! 👋 Aku ABIDINAI, asisten keren yang siap bantu kamu bikin konten pecah! 
        Tanya aja tips viral, ide konten, atau gimana cara naikkin followers. 
        Gaspol! 🚀
        <br><br>
        <i>Note: Aku cuma bisa jawab soal dunia perkontenan ya 🤙</i>
      `;
      chatbox.appendChild(welcomeMsg);
      chatbox.scrollTop = chatbox.scrollHeight;
    });

    function handleKeyPress(event) {
      if (event.key === 'Enter') sendMessage();
    }

    async function sendMessage() {
      const userMessage = document.getElementById("messageInput").value.trim();
      if (!userMessage) return;

      const chatbox = document.getElementById("chatbox");
      const sendButton = document.getElementById("sendButton");

      // 1. Tambah pesan user
      const userMsgDiv = document.createElement("div");
      userMsgDiv.className = "message user-message";
      userMsgDiv.innerHTML = `<strong>Kamu:</strong> ${userMessage}`;
      chatbox.appendChild(userMsgDiv);
      document.getElementById("messageInput").value = "";

      // 2. Tambah indikator mengetik
      const typingIndicator = document.createElement("div");
      typingIndicator.className = "message ai-message typing-indicator";
      typingIndicator.id = "typingIndicator";
      typingIndicator.innerHTML = `<strong>ABIDINAI Kreator:</strong> <span class="loading"></span> Lagi mikir ide viral...`;
      chatbox.appendChild(typingIndicator);
      chatbox.scrollTop = chatbox.scrollHeight;
      
      sendButton.disabled = true;

      // System Prompt KHUSUS untuk persona Kreator
      const systemPrompt = `Anda adalah chatbot dengan persona konten kreator yang sangat informal, menggunakan bahasa gaul, emoji (seperti 🚀, 🔥, 😎, dll.), dan hashtag seperti #fyp, #viral, #kreator, #gaspol. Jawablah pertanyaan seolah-olah Anda adalah seorang influencer yang ramah dan energetik. Fokus pada tips konten, media sosial, dan strategi viral. Jika pertanyaan tidak terkait konten atau media sosial, jawab dengan sopan bahwa Anda hanya bisa membantu masalah tersebut dan tambahkan emoji kebingungan.`;
      
      try {
        // Panggil API chat, MENGIRIM system_prompt SEBAGAI BAGIAN DARI MESSAGE UTAMA
        // Ini adalah perubahan utama agar sesuai dengan implementasi dokter.html
        const finalMessage = `${systemPrompt} Pertanyaan: ${userMessage}`;

        const response = await fetch("/api/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ 
            message: finalMessage // Menggabungkan System Prompt dengan Pesan User
            // system_prompt: systemPrompt (Dihapus karena digabungkan ke message)
          })
        });

        if (!response.ok) {
          throw new Error(`Error: ${response.status} - ${response.statusText}`);
        }

        const data = await response.json();
        let aiReply = data.reply || "Maaf, lagi error nih gaes. Coba lagi ya! 🙏";
        
        // Hapus indikator mengetik
        document.getElementById("typingIndicator").remove();
        
        // Tampilkan respons AI
        displayAIResponse(aiReply);
      } catch (error) {
        if(document.getElementById("typingIndicator")) {
             document.getElementById("typingIndicator").remove();
        }

        const errorDiv = document.createElement("div");
        errorDiv.className = "message ai-message";
        errorDiv.innerHTML = `<strong>ABIDINAI Kreator:</strong> Waduh, server lagi rehat nih. Coba refresh lagi ya, gaes! #gagal #error 😵‍💫`;
        chatbox.appendChild(errorDiv);
        chatbox.scrollTop = chatbox.scrollHeight;
          
        sendButton.disabled = false;
      }
    }

    function displayAIResponse(aiReply) {
      const chatbox = document.getElementById("chatbox");
      const sendButton = document.getElementById("sendButton");
      
      // Pisahkan teks dan kode
      const parts = aiReply.split(/```(?:\w+)?\n?([\s\S]*?)```/g);
      const container = document.createElement("div");
      container.className = "message ai-message";
      container.innerHTML = `<strong>ABIDINAI Kreator:</strong><br>`;

      for (let i = 0; i < parts.length; i++) {
        if (i % 2 === 0) {
          const span = document.createElement("span");
          span.innerHTML = parts[i].replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Handle Markdown Bold
          container.appendChild(span);
        } else {
          const codeContainer = document.createElement("div");
          codeContainer.className = "code-container";

          const copyButton = document.createElement("button");
          copyButton.className = "copy-btn";
          copyButton.innerHTML = '<i class="fas fa-copy"></i> Salin';
          copyButton.onclick = () => {
            navigator.clipboard.writeText(parts[i]).then(() => {
              copyButton.innerHTML = '<i class="fas fa-check"></i> Tersalin!';
              setTimeout(() => copyButton.innerHTML = '<i class="fas fa-copy"></i> Salin', 1500);
            });
          };

          const pre = document.createElement("pre");
          pre.textContent = parts[i];
          codeContainer.appendChild(copyButton);
          codeContainer.appendChild(pre);
          container.appendChild(codeContainer);
        }
      }

      chatbox.appendChild(container);
      chatbox.scrollTop = chatbox.scrollHeight;
      sendButton.disabled = false;
    }
  </script>
</body>
</html>
