<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Terjemahan AbidinAI - Elegan</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Custom Font */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

    /* Color Palette - Dark Mode Modern */
    :root {
      --primary-color: #4a90e2; /* Biru Primer yang Cerah */
      --secondary-color: #38c172; /* Hijau Aksen */
      --background-dark: #121212; /* Hampir Hitam */
      --card-bg: #1e1e1e; /* Sedikit Lebih Cerah dari Background */
      --text-light: #e0e0e0;
      --text-muted: #a0a0a0;
      --border-color: #333;
    }
    
    /* Reset & Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif; 
      background: var(--background-dark); 
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 0;
      overflow-x: hidden;
    }

    /* Top Bar */
    .top-bar-mock {
        width: 100%;
        max-width: 500px;
        position: fixed;
        top: 0;
        z-index: 10;
        background-color: var(--card-bg);
        border-bottom: 1px solid var(--border-color);
        padding: 10px 15px;
        display: flex;
        align-items: center;
        text-align: left;
        box-shadow: 0 2px 5px rgba(0,0,0,0.4);
    }

    .top-bar-mock .menu-icon {
        font-size: 24px;
        color: var(--primary-color);
        margin-right: 15px;
    }

    .top-bar-mock .title-bar {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-light);
    }

    /* Container Utama */
    .container {
      width: 100%;
      max-width: 500px;
      background: var(--background-dark); 
      padding: 15px 15px 30px; 
      margin-top: 55px; 
    }

    /* Header Konten */
    .header {
      margin-bottom: 25px;
      padding-top: 15px;
      text-align: left;
    }
    
    .title {
      font-size: 26px;
      margin-bottom: 8px;
      color: var(--text-light);
      font-weight: 700;
    }
    
    .subtitle {
      font-size: 14px;
      color: var(--text-muted);
    }
    
    /* Translator Block */
    .translator-block {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 0;
        margin-bottom: 25px;
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.5); 
        border: 1px solid var(--border-color);
    }

    .translator-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--primary-color);
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        background-color: #252525;
        border-top-left-radius: 11px;
        border-top-right-radius: 11px;
        border-bottom: 1px solid var(--border-color);
    }

    .translator-title i {
        color: var(--secondary-color);
    }
    
    /* Input Teks */
    #messageInput {
      width: 100%;
      height: 120px; 
      padding: 20px;
      border: none;
      background: transparent;
      color: var(--text-light);
      font-size: 16px;
      resize: none;
      font-style: italic; 
    }
    
    #messageInput:focus {
      outline: none;
      /* Border bawah berubah saat fokus */
      border-bottom: 2px solid var(--primary-color);
    }
    
    /* Dropdown Bahasa Tujuan */
    .language-select-group {
        padding: 0 20px;
        margin-bottom: 20px;
        padding-top: 15px;
    }

    .language-select-group p {
        text-align: left;
        font-size: 14px;
        color: var(--text-muted);
        margin-bottom: 8px;
        font-weight: 400;
    }

    #targetLanguage {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: #000;
        color: var(--text-light);
        font-size: 16px;
        appearance: none;
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%2D%2224%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%234A90E2%22%20d%3D%22M7%2010l5%205%205-5z%22%2F%3E%3C%2Fsvg%3E');
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 20px;
        cursor: pointer;
    }
    
    #targetLanguage option {
        background-color: #121212;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 15px;
        padding: 0 20px 20px;
    }
    
    #recordButton, #sendButton {
      flex: 1;
      padding: 14px 20px;
      border-radius: 8px; 
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 15px;
      text-transform: uppercase;
    }
    
    #recordButton {
        background-color: var(--primary-color); 
        color: var(--background-dark);
        box-shadow: 0 4px 0 #3a75b8;
    }

    #recordButton:hover {
        background-color: #3a75b8;
        box-shadow: 0 4px 0 #2a5a8a;
    }

    #sendButton {
      background-color: var(--secondary-color); 
      color: var(--background-dark);
      box-shadow: 0 4px 0 #2c9a59;
    }
    
    #sendButton:hover {
      background-color: #2c9a59;
      box-shadow: 0 4px 0 #1e6c3e;
    }
    
    #recordButton:active, #sendButton:active {
        box-shadow: none;
        transform: translateY(4px);
    }

    #sendButton:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    /* Area Hasil Terjemahan */
    .translation-result-area {
        min-height: 100px;
        padding: 20px;
        margin-top: 30px;
        background: #252525;
        border-radius: 10px;
        border-left: 5px solid var(--secondary-color);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        text-align: left;
        white-space: pre-wrap;
        font-size: 16px;
        color: var(--text-light);
    }

    .translation-result {
        font-weight: 600;
        color: var(--text-light);
        font-style: normal;
    }

    .initial-message {
        color: var(--text-muted);
        font-style: italic;
    }

    .loading-indicator {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--primary-color);
        font-style: normal;
    }

    /* Animation */
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(74, 144, 226, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 0.8s linear infinite;
      vertical-align: middle;
    }
    
    /* Media Queries */
    @media (max-width: 600px) {
        .container { margin-top: 55px; padding: 10px 10px 20px; }
        .action-buttons { flex-direction: column; gap: 10px; padding: 0 10px 10px; }
        #recordButton, #sendButton { padding: 12px 15px; font-size: 14px; }
    }
  </style>
</head>
<body>
  
  <div class="top-bar-mock">
      <i class="fas fa-bars menu-icon"></i>
      <div class="title-bar">AbidinAI Translator</div>
  </div>

  <div class="container">
    
    <div class="header">
      <h1 class="title"><i class="fas fa-globe"></i> Terjemahan Otomatis AbidinAI</h1>
      <p class="subtitle">Terjemahkan teks atau suara Anda ke berbagai bahasa dengan kecepatan AI.</p>
    </div>
    
    <div class="translator-block">
      <div class="translator-title">
        <i class="fas fa-comment-dots"></i> Input Teks atau Suara
      </div>
      
      <textarea id="messageInput" placeholder="Ketik teks yang ingin Anda terjemahkan di sini..." onkeypress="handleKeyPress(event)"></textarea>
      
      <div class="language-select-group">
        <p>Pilih Bahasa Tujuan:</p>
        <select id="targetLanguage">
          <option value="id" selected>Indonesia</option>
          <option value="en">Inggris</option>
          <option value="zh">Mandarin</option>
          <option value="ja">Jepang</option>
          <option value="ko">Korea</option>
          <option value="ar">Arab</option>
          <option value="fr">Prancis</option>
          <option value="es">Spanyol</option>
          <option value="de">Jerman</option>
        </select>
      </div>
      
      <div class="action-buttons">
        <button onclick="startVoiceRecognition()" id="recordButton">
          <i class="fas fa-microphone"></i> Rekam Suara
        </button>
        <button onclick="sendMessage()" id="sendButton">
          <i class="fas fa-exchange-alt"></i> Terjemahkan
        </button>
      </div>
    </div>
      
    <div class="translation-result-area" id="translationResultArea">
      <span class="initial-message">Hasil terjemahan akan muncul di sini.</span>
    </div>
    
  </div>

  <script>
    let isVoiceInput = false;
    
    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        event.preventDefault(); 
        sendMessage();
      }
    }

    async function sendMessage() {
      const sourceText = document.getElementById("messageInput").value.trim();
      const targetLang = document.getElementById("targetLanguage").options[document.getElementById("targetLanguage").selectedIndex].text;
      const targetLangCode = document.getElementById("targetLanguage").value;

      if (!sourceText) {
        alert("Mohon masukkan teks yang ingin diterjemahkan.");
        return;
      }

      const resultArea = document.getElementById("translationResultArea");
      const sendButton = document.getElementById("sendButton");

      // Tampilkan indikator loading
      resultArea.innerHTML = `
        <div class="loading-indicator">
          <span class="loading"></span>
          <span>Menerjemahkan ke ${targetLang}...</span>
        </div>
      `;
      sendButton.disabled = true;

      // Logika Prompt Groq AI untuk Terjemahan
      const systemPrompt = `Anda adalah ahli terjemahan profesional. Tugas Anda adalah menerjemahkan teks pengguna ke dalam bahasa ${targetLang} (${targetLangCode}). Berikan HANYA teks hasil terjemahan tanpa penjelasan, salam, atau teks tambahan apa pun. Teks harus akurat dan alami.`;
      const userMessage = sourceText;

      try {
        // ASUMSI: Endpoint /api/chat di server.js Anda menangani Groq AI
        const response = await fetch("/api/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ 
            message: userMessage,
            system_prompt: systemPrompt 
          })
        });

        if (!response.ok) {
          throw new Error(`Error: ${response.status} - ${response.statusText}`);
        }

        const data = await response.json();
        let translatedText = data.reply || "Gagal mendapatkan hasil terjemahan. Coba lagi.";
        
        // Tampilkan hasil terjemahan
        resultArea.innerHTML = `<span class="translation-result">${translatedText}</span>`;

      } catch (error) {
        console.error("Translation Error:", error);
        resultArea.innerHTML = `<span style="color: #ff5555;">Terjadi kesalahan saat menerjemahkan. Coba periksa koneksi atau coba lagi nanti.</span>`;
      } finally {
        sendButton.disabled = false;
        isVoiceInput = false;
      }
    }

    // --- LOGIKA VOICE RECOGNITION ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    let isRecording = false;

    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.lang = 'id-ID'; // Bahasa sumber default adalah Indonesia
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onstart = () => {
        isRecording = true;
        const recordButton = document.getElementById("recordButton");
        recordButton.innerHTML = '<i class="fas fa-stop"></i> Berhenti Merekam';
        recordButton.style.backgroundColor = '#dc3545'; // Merah saat merekam
        recordButton.style.boxShadow = '0 4px 0 #a71d2a';
        recordButton.style.transform = 'translateY(0)';
        document.getElementById("translationResultArea").innerHTML = "Sedang mendengarkan... Bicara sekarang.";
      };

      recognition.onresult = (event) => {
        const voiceText = event.results[0][0].transcript;
        document.getElementById("messageInput").value = voiceText;
        isVoiceInput = true;
        stopRecordingUI();
        // Langsung terjemahkan setelah suara selesai direkam
        sendMessage(); 
      };

      recognition.onerror = (event) => {
        alert('Gagal mengenali suara: ' + event.error);
        stopRecordingUI();
      };
      
      recognition.onend = () => {
        if(isRecording) { // Jika recognition berakhir tanpa hasil (timeout/error)
             stopRecordingUI();
        }
      };
    } 

    function stopRecordingUI() {
        isRecording = false;
        const recordButton = document.getElementById("recordButton");
        recordButton.innerHTML = '<i class="fas fa-microphone"></i> Rekam Suara';
        recordButton.style.backgroundColor = 'var(--primary-color)';
        recordButton.style.boxShadow = '0 4px 0 #3a75b8';
        recordButton.style.transform = 'translateY(0)';
    }

    function startVoiceRecognition() {
      if (recognition) {
        if (isRecording) {
            recognition.stop();
        } else {
            try {
              recognition.start();
            } catch (e) {
              console.error("Error starting recognition:", e);
              alert("Gagal memulai rekaman. Pastikan mikrofon Anda aktif.");
            }
        }
      } else {
        alert("Browser tidak mendukung pengenalan suara.");
      }
    }
  </script>
</body>
</html>
